{% extends "base_AdminLTE.html"%}
{% block title %}Docklet | Batch Job{% endblock %}

{% block panel_title %}Batch Job{% endblock %}

{% block panel_list %}
<ol class="breadcrumb">
  <li>
      <a href="/dashboard/"><i class="fa fa-dashboard"></i>Home</a>
  </li>
  <li class="active">
      <strong>Batch Job</strong>
  </li>
</ol>
{% endblock %}
{% block content %}
<div class="row">
         <div class="col-lg-12">
           <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">Batch Job List</h3>

                  <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                  </div>
                </div>
                 <div class="box-body">

					 <p>
					 <a href="/batch_job/create/"><button type="button" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> Create Batch Job</button></a>
					 </p>
                 {% for job_info in job_list %}
                 <div class="modal inmodal" id='OutputModal_{{ job_info['job_id'] }}' tabindex="-1" role="dialog" aria-hidden="true">
                   <div class="modal-dialog">
                     <div class="modal-content animated fadeIn">
                       <div class="modal-header">
                         <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                         <h4 class="modal-title">Job:{{ job_info['job_name'] }}({{ job_info['job_id'] }}) Stdout and Stderr of tasks</h4>
                       </div>
                       <div class="modal-body">
                         <table width="100%" cellspacing="0" class="table table-bordered table-striped table-hover table-output">
                           <thead>
                             <tr>
                               <th>Task ID</th>
                               <th>Instance ID</th>
                               <th>Stdout</th>
                               <th>Stderr</th>
                             </tr>
                           </thead>
                           <tbody>
                             {% for taskid in job_info['tasks'] %}
                             {% for vnodeid in range(job_info['tasks_vnodeCount'][taskid]) %}
                             <tr>
                               <td>{{ taskid }}</td>
                               <td>{{ vnodeid }}</td>
                               <td><a class="btn btn-info btn-xs" href='/batch_job/output/{{ job_info["job_id"] }}/{{ taskid }}/{{ vnodeid }}/stdout/' target="_blank">Stdout</a></td>
                               <td><a class="btn btn-info btn-xs" href='/batch_job/output/{{ job_info["job_id"] }}/{{ taskid }}/{{ vnodeid }}/stderr/' target="_blank">Stderr</a></td>
                             </tr>
                             {% endfor %}
                             {% endfor %}
                           </tbody>
                         </table>
                         <div class="modal-footer">
                           <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                         </div>
                       </div>
                     </div>
                   </div>
                 </div>
                 {% endfor %}
                 <div class="table">
                 <table width="100%" cellspacing="0" style="margin: 0 auto;" class="table table-striped table-bordered table-hover table-batch">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Tasks</th>
                            <th>Operations</th>
                            <th>Create Time</th>
                            <th>Stdout and Stderr</th>
                        </tr>
                    <thead>
                    <tbody>
                    {% for job_info in job_list %}
                        <tr>
                            <td>{{ job_info['job_id'] }}</td>
                            <td>{{ job_info['job_name'] }}</td>
                            <td>
                            {{ job_info['status'] }}
                          </td>
                            <td>Tasks</td>
				            <td><button type="button" class="btn btn-xs btn-default">&nbsp;&nbsp;&nbsp;Stop&nbsp;&nbsp;&nbsp;</button></td>
                            <td>{{ job_info['create_time'] }}</td>
                            <td><a role="button" class="btn btn-info btn-xs" id='{{ job_info['job_id'] }}_output' data-toggle="modal" data-target='#OutputModal_{{ job_info['job_id'] }}'>Get Output</a></td>
                        </tr>
                    {% endfor %}
                    </tbody>
                 </table>
                 </div>
               </div>
             </div>
         </div>
	</div>

{% endblock %}
{% block script_src %}
<script src="//cdn.bootcss.com/datatables/1.10.11/js/jquery.dataTables.min.js"></script>
<script src="//cdn.bootcss.com/datatables/1.10.11/js/dataTables.bootstrap.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
   $(".table-batch").DataTable({"scrollX":true});
   $(".table-output").DataTable({
   "lengthChange":false});
});
function sendAdd(){
    document.getElementById("addForm").submit();
}
function sendDel(){
    document.getElementById("delForm").submit();
}
</script>
{% endblock %}
